@using Entidades;
@model ENVendedores
@{
    ViewBag.Title = "Vendedores";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    @Styles.Render("~/Content/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css")
    @Styles.Render("~/Content/plugins/datatables-responsive/css/responsive.bootstrap4.min.css")
    @Styles.Render("~/Content/plugins/sweetalert2/sweetalert2.min.css")
    @Styles.Render("~/Content/plugins/select2/css/select2.min.css")
}

<style>

    #loading {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url('../../Images/loading.gif') 50% 50% no-repeat rgba(249, 249, 249, 0.7);
    }

    .modal-backdrop.fade {
        opacity: 0;
        filter: alpha(opacity=0);
    }

    .modal-backdrop.in {
        opacity: 0.5;
        filter: alpha(opacity=50);
    }
</style>
<div id="loading" style="display:none;">
</div>
<div id="content" class="row">
    <div class="col-12">
        <div class="card card-primary card-outline">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-users"></i>
                    Administracion de Vendedores
                </h3>
            </div>
            <!-- /.card-header -->
            <div class="card-body ">
                @using (Html.BeginForm("GetLista", "Vendedor", FormMethod.Get, new { id = "Form1", name = "Form1" }))
                {
                    <div class="row">
                        <div class="btn-group-justified">
                            <button type="button" id="btnVendedor" class="btn btn-info btn-sm">
                                @*onclick=PopupForm('@Url.Action("Modal","Vendedor")')>*@
                                <i class="fa fa-plus text-warning"></i>&nbsp;&nbsp;Agregar Vendedor
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" hidden>
                                <i class="fa fa-building text-warning"></i>&nbsp;&nbsp;Sociedad
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" hidden>
                                <i class="fa fa-place-of-worship text-warning"></i>&nbsp;&nbsp;Canales
                            </button>
                        </div>
                    </div>
                    <hr />
                    <!-- form here -->
                    <div class="row pt-2 pb-2">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="text-uppercase" for="txtdesde">SOCIEDAD &nbsp;&nbsp;</label>
                                @Html.DropDownList("slcSociedad", ViewData["ListaSociedades"] as SelectList, new { @class = "form-control form-control-sm js-example-basic-single" })
                            </div>
                            <button type="submit" class="btn btn-dark btn-sm">
                                <i class="fa fa-search text-warning"></i>&nbsp;&nbsp;Buscar
                            </button>
                        </div>
                        @*<div class="col-md-4" hidden>
                            <div class="form-group">
                                <label class="text-uppercase" for="txtdesde">Nombres / Apellidos / DNI &nbsp;&nbsp;</label>
                                <div class="input-group mb-3">
                                    @Html.TextBoxFor(m => m.Nombres,
                                   new { @class = "form-control form-control-sm", @type = "text", placeholder = "Ingrese texto de búsqueda" })
                                    <div class="input-group-append">
                                        <button type="submit" id="btnbusca" class="btn btn-dark btn-sm">
                                            <i class="fa fa-search"></i>&nbsp;&nbsp;Buscar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>*@
                    </div>
                }
                <table id="dglista" class="table table-bordered table-hover table-sm">
                    <thead class="thead-light">
                        <tr>
                            <th>CODIGO</th>
                            <th>APELLIDO PATERNO</th>
                            <th>APELLIDO MATERNO</th>
                            <th>NOMBRES</th>
                            <th>DIRECCION</th>
                            <th>TELEFONO</th>
                            <th>EMAIL</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewData["Vendedores"] != null)
                        {
                            foreach (ENVendedores ven in (List<ENVendedores>)ViewData["Vendedores"])
                            {
                        <tr>
                            <td>@ven.CodigoVendedor </td>
                            <td>@ven.ApellidoPaterno </td>
                            <td>@ven.ApellidoMaterno </td>
                            <td>@ven.Nombres </td>
                            <td>@ven.Direccion </td>
                            <td>@ven.Telefono </td>
                            <td>@ven.Email </td>
                            <td>
                                <button type="button" class="botonedit btn btn-info btn-sm">
                                    <i class="fa fa-edit text-white"></i>
                                </button>
                                <button type="button" class="botondel btn btn-danger btn-sm">
                                    <i class="fa fa-times text-white"></i>
                                </button>
                            </td>
                        </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <!-- /.card-body -->
        </div>

    </div>
    <!-- /.col -->
</div>

<div class="modal" id="modalNuevoVendedor" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="exampleModalLabel"><i class="fa fa-7x fa-plus  text-warning"></i>&nbsp;&nbsp;Agregar Vendedor</h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @using (Html.BeginForm("Mantenimiento", "Vendedor", FormMethod.Post, new { onsubmit = "return SubmitForm(this)" }))
                {
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <h6>Sociedad</h6>
                                @Html.DropDownListFor(model => model.IdSociedad, ViewData["ListaSociedades"] as SelectList, new { @class = "form-control form-control-sm js-example-basic-single" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <h6>DNI</h6>
                                @Html.TextBoxFor(model => model.DNI, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <h6>Nombres</h6>
                                @Html.TextBoxFor(model => model.Nombres, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.Nombres, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <h6>Apellido Paterno</h6>
                                @Html.TextBoxFor(model => model.ApellidoPaterno, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.ApellidoPaterno, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <h6>Apellido Materno</h6>
                                @Html.TextBoxFor(model => model.ApellidoMaterno, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.ApellidoMaterno, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <h6>Dirección</h6>
                                @Html.TextBoxFor(model => model.Direccion, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.Direccion, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <h6>Teléfono</h6>
                                @Html.TextBoxFor(model => model.Telefono, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.Telefono, "", new { @class = "text-danger" })
                            </div>
                            <div class="form-group">
                                <h6>Email</h6>
                                @Html.TextBoxFor(model => model.Email, new { @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-dark btn-sm">
                            <i class="fa fa-building text-warning"></i>&nbsp;&nbsp;Guardar Datos
                        </button>
                    </div>
                }
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Send message</button>
                </div>*@
        </div>
    </div>
</div>


@section Scripts {
    @Scripts.Render("~/Content/plugins/datatables/jquery.dataTables.min.js")
    @Scripts.Render("~/Content/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js")
    @Scripts.Render("~/Content/plugins/datatables-responsive/js/dataTables.responsive.min.js")
    @Scripts.Render("~/Content//plugins/datatables-responsive/js/responsive.bootstrap4.min.js")
    @Scripts.Render("~/Content/plugins/sweetalert2/sweetalert2.min.js")
    @Scripts.Render("~/Content/plugins/select2/js/select2.full.min.js")

    <script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
        });
    </script>

    <script>
        $(function () {

            $('#dglista').DataTable({
                "paging": true,
                "lengthChange": false,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
                "lengthMenu": [[5, 10, 50, -1], [5, 10, 50, "Todos"]],
                "pageLength": 50,
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.10.21/i18n/Spanish.json"
                }
            });
        });
    </script>
    <script>
        //function SelectedIndexChanged() {
        //    //Form post
        //    document.Form1.submit();
        //}

        $('#btnVendedor').click(function () {
            $('#modalNuevoVendedor').modal('show');
        });

        $(".botonedit").click(function () {
            txt1 = $(this).parents('tr').find("td:eq(0)").text();
            txt2 = $(this).parents('tr').find("td:eq(1)").text();
            txt3 = $(this).parents('tr').find("td:eq(2)").text();
            txt4 = $(this).parents('tr').find("td:eq(3)").text();
            txt5 = $(this).parents('tr').find("td:eq(4)").text();
            txt6 = $(this).parents('tr').find("td:eq(5)").text();
            txt7 = $(this).parents('tr').find("td:eq(6)").text();

            document.getElementById("DNI").value = txt1;
            document.getElementById("Nombres").value = txt2;
            document.getElementById("ApellidoPaterno").value = txt3;
            document.getElementById("ApellidoMaterno").value = txt4;
            document.getElementById("Direccion").value = txt5;
            document.getElementById("Telefono").value = txt6;
            document.getElementById("Email").value = txt7;

            $('#modalNuevoVendedor').modal('show');

        });

        $(".botondel").click(function () {
            txt = $(this).parents('tr').find("td:eq(0)").text();
            console.log(txt);

        });

            //function PopupForm(url) {
            //    var formDiv = $('<div/>');
            //    $.get(url)
            //        .done(function (response) {
            //            formDiv.html(response);

            //            Popup = formDiv.dialog({
            //                autoOpen: true,
            //                resizable: true,
            //                title: 'Datos del Vendedor',
            //                height: 500,
            //                width: 700,
            //                close: function () {
            //                    Popup.dialog('destroy').remove();
            //                }

            //            });
            //        });
            //}

    </script>



}

